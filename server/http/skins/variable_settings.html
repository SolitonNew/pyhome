<script type="text/javascript">
    function variable_settings_change() {
        if ($('#VAR_TYPE').val() == 'variable')
            $('#value_row').css('display', 'table-row');
        else
            $('#value_row').css('display', 'none');

        if ($('#VAR_TYPE').val() == 'ow')
            $('#ow_row').css('display', 'table-row');
        else
            $('#ow_row').css('display', 'none');        
    }

    function reload_ow() {
        var v = $('#VAR_OW').val();
        $.ajax({url:'variable_settings?refresh_ow=1&key=' + v, success:reload_ow_handler});
    }

    function reload_ow_handler(data) {
        $('#VAR_OW').html(data);
    }

    $(document).ready(function() {
        variable_settings_change();

        $("#VARIABLE_SETTINGS").ajaxForm(function(data) {
            if (data == "OK")
                hide_window();
            else
                alert(data); 
        }); 
    });
</script>

<div style="positon:relative;width:450px;background-color:#fff;border: 10px solid #fff;">
    <div style="position:relative;padding:10px;background-color:#eee;">
        Свойства переменной
    </div>
    <form id="VARIABLE_SETTINGS" action="variable_settings" method="GET">
    <input id="VAR_KEY" name="VAR_KEY" type="hidden" value="@KEY@">
    <table cellpadding="0" cellspacing="10" width="100%">
    <TR>
        <TD colspan="2"></TD>
    </TR>    
    <TR>
        <TD>Контроллер:</TD>
        <TD>
            <select id="VAR_CONTROLLER" name="VAR_CONTROLLER" onChange="variable_settings_change()">
                @CONTROLLER_LIST@
            </select>
        </TD>
    </TR>
    <TR>
        <TD>Тип:</TD>
        <TD>
            <select id="VAR_TYPE" name="VAR_TYPE" onChange="variable_settings_change()">
                @TYPE_LIST@
            </select>
        </TD>
    </TR>
    <TR id="ow_row">
        <TD valign="top">OW устройство:</TD>
        <TD>
            <select id="VAR_OW" name="VAR_OW" multiple style="width:100%;height:100px;">
                @OW_LIST@
            </select>            
            <p style="padding:0px;margin:3px;width:100%;text-align:right;">
                <button type="button" onClick="reload_ow();">Обновить список</button>
            </p>
        </TD>
    </TR>
    <TR>
        <TD>Только чтение:</TD>
        <TD>
            <select id="VAR_READ_ONLY" name="VAR_READ_ONLY" onChange="variable_settings_change()">
                @READ_ONLY_LIST@
            </select>
        </TD>
    </TR>
    <TR>
        <TD>Название:</TD>
        <TD><input id="VAR_NAME" name="VAR_NAME" type="text" value="@NAME@" onChange="variable_settings_change()"/></TD>
    </TR>
    <TR>
        <TD valign="top">Описание:</TD>
        <TD><textarea id="VAR_COMM" name="VAR_COMM" style="width:250px;height:50px;">@COMM@</textarea></TD>
    </TR>
    <TR id="value_row">
        <TD>Значение:</TD>
        <TD><input id="VAR_VALUE" name="VAR_VALUE" type="text" value="@VALUE@"/></TD>
    </TR>
    <TR>
        <TD>Канал:</TD>
        <TD><input id="VAR_CHANNEL" name="VAR_CHANNEL" type="text" value="@CHANNEL@"/></TD>
    </TR>
    <TR>
        <TD colspan="2" align="right" valign="bottom" height="60">
            <button type="submit">Готово</button>
            <button type="button" onClick="hide_window()">Закрыть</button>
        </TD>
    </TR>
    </table>
    </form>
</div>
